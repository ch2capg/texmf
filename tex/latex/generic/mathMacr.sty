%  Revision history
%  --------------------------------------------------
%
%       Revised by Christian Power August - October 2016
%       Originally written by Christian Power
%            (power22c@gmail.com) August 2016
% 
%  Math macros for my math papers and PhD.
%  Copyright (c) 2016 Christian Power.  All rights reserved.
% ----------------------------------------------------------------------

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mathMacr}[2016/10/13 v0.9.1 math macros]

\newcommand*\Q{\mathds{Q}}
\newcommand*\Z{\mathds{Z}}
\newcommand*\R{\mathds{R}}
\newcommand*\N{\mathds{N}}
\newcommand*\C{\mathds{C}}
\newcommand*\K{\mathds{K}}
\newcommand*\id{\mathds{1}}
\newcommand*\ima{\mathrm{i}}
\newcommand*\dotarg{\:\cdot\:}
\newcommand*\conv\ast
\newcommand*\impr\Rightarrow
\newcommand*\impl\Leftarrow
\newcommand*\aqui\Leftrightarrow
\newcommand*\del\partial
\newcommand*\dif{\mathop{}\!\mathrm{d}}
\newcommand*\Dif{\mathop{}\!\mathrm{D}}
\newcommand*\laplace\Delta
\newcommand*\csubset\Subset
\newcommand*\csupset\Supset
\newcommand*\osubset{\subset_{\mathrm{o}}}
\newcommand*\cosubset{\Subset_{\mathrm{o}}}
\newcommand*\boundary\del
\newcommand*\union\cup
\newcommand*\bunion\bigcup
\newcommand*\inters\cap
\newcommand*\binters\bigcap
% ----------------------------------------------------------------------
\newcommand*\ov[1]{\overline{#1}}
\newcommand*\ul[1]{\underline{#1}}
\newcommand*\fft[1]{\widehat{#1}}
\newcommand*\ifft[1]{\widecheck{#1}}
\newcommand*\ifBlankDot[1]{\ifblank{#1}{\dotarg}{#1}}
% ----------------------------------------------------------------------
\DeclareMathOperator\gl{GL}
\DeclareMathOperator\im{Im}
\DeclareMathOperator\rg{rg}
\DeclareMathOperator\mat{Mat}
\DeclareMathOperator\grad{grad}
\DeclareMathOperator\Div{div}
\DeclareMathOperator\supp{supp}
\DeclareMathOperator\graph{graph}
\DeclareMathOperator\pr{pr}
\DeclareMathOperator\diag{diag}
\DeclareMathOperator\codim{codim}
\DeclareMathOperator\sym{sym}
\DeclareMathOperator\jac{jac}
\DeclareMathOperator\hess{hess}
\DeclareMathOperator\tr{trace}
\DeclareMathOperator\sgn{sgn}
\DeclareMathOperator\const{const}
\DeclareMathOperator\vol{vol}
\DeclareMathOperator\diam{diam}
\DeclareMathOperator\Int{int}
% ----------------------------------------------------------------------
\NewDocumentCommand\inv{som}
{\IfBooleanTF #1
  {\deli*{#3}[-1]}
  {\IfNoValueTF{#2}
    {#3^{-1}}
    {\deli[#2]{#3}[-1]}
  }
}
\NewDocumentCommand\trans{som}
{\IfBooleanTF #1
  {\deli*{#3}[][][\mathrm{t}]}
  {\IfNoValueTF{#2}
    {\prescript{\mathrm{t}}{}{#3}}
    {\deli[#2]{#3}[][][\mathrm{t}]}
  }
}
\NewDocumentCommand\landau{som}
{\IfBooleanTF #1
  {\fromArg*{\mathcal{O}}{#3}}
  {\IfNoValueTF{#2}
    {\mathcal{O}(#3)}
    {\fromArg[#2]{\mathcal{O}}{#3}}
  }
}
% ----------------------------------------------------------------------
\DeclarePairedDelimiterXPP\absDPD[3]{}\lvert\rvert
{\ifblank{#2}{}{^{#2}}\ifblank{#3}{}{_{#3}}}
{\ifblank{#1}{\dotarg}{#1}}
\NewDocumentCommand\abs{sO{}mO{}O{}O{}O{}}
{\IfBooleanTF #1
  {\prescript{#6}{#7}{\absDPD*{#3}{#4}{#5}}}
  {\prescript{#6}{#7}{\absDPD[#2]{#3}{#4}{#5}}}
}
% ----------
\DeclarePairedDelimiterXPP\normDPD[3]{}\lVert\rVert
{\ifblank{#2}{}{^{#2}}\ifblank{#3}{}{_{#3}}}
{\ifblank{#1}{\dotarg}{#1}}
\NewDocumentCommand\norm{sO{}mO{}O{}O{}O{}}
{\IfBooleanTF #1
  {\prescript{#6}{#7}{\normDPD*{#3}{#4}{#5}}}
  {\prescript{#6}{#7}{\normDPD[#2]{#3}{#4}{#5}}}
}
% ----------
\DeclarePairedDelimiterXPP\deliDPD[3]{}() % Delimiter
{\ifblank{#2}{}{^{#2}}\ifblank{#3}{}{_{#3}}}
{\ifblank{#1}{\dotarg}{#1}}
\NewDocumentCommand\deli{sO{}mO{}O{}O{}O{}}
{\IfBooleanTF #1
  {\prescript{#6}{#7}{\deliDPD*{#3}{#4}{#5}}}
  {\prescript{#6}{#7}{\deliDPD[#2]{#3}{#4}{#5}}}
}
\let\args\deli  % Arguments (usually with round brackets)
% ----------
\DeclarePairedDelimiterXPP\formArgDPD[4]{#1}() % Multilinear form
{\ifblank{#3}{}{^{#3}}\ifblank{#4}{}{_{#4}}}
{#2}
\NewDocumentCommand\formArg{sO{}mmO{}O{}O{}O{}}
{\IfBooleanTF #1
  {\prescript{#7}{#8}{\formArgDPD*{#3}{#4}{#5}{#6}}}
  {\prescript{#7}{#8}{\formArgDPD[#2]{#3}{#4}{#5}{#6}}}
}
% ----------
\DeclarePairedDelimiterX\cbr[1]\{\}{
  \ifblank{#1}{\dotarg}{#1}
}
\DeclarePairedDelimiterX\sbr[1][]{
  \ifblank{#1}{\dotarg}{#1}
}
% ----------
\DeclarePairedDelimiterXPP\abrDPD[3]{}\langle\rangle % Delimiter
{\ifblank{#2}{}{^{#2}}\ifblank{#3}{}{_{#3}}}
{\ifblank{#1}{\dotarg}{#1}}
\NewDocumentCommand\abr{sO{}mO{}O{}O{}O{}}
{\IfBooleanTF #1
  {\prescript{#6}{#7}{\abrDPD*{#3}{#4}{#5}}}
  {\prescript{#6}{#7}{\abrDPD[#2]{#3}{#4}{#5}}}
}
% ----------
\providecommand\given{}  % just to make sure it exists
% can be useful to refer to this outside \Set
\newcommand*\SetSymbol[1][]{
  \nonscript\:#1\vert
  \allowbreak
  \nonscript\:
  \mathopen{}}
\DeclarePairedDelimiterX\Set[1]\{\}{%
  \renewcommand\given{\SetSymbol[\delimsize]}
  #1
}
% ----------
\DeclarePairedDelimiterXPP\braketDPD[5]{}\langle\rangle
{\ifblank{#4}{}{^{#4}}\ifblank{#5}{}{_{#5}}}
{ \ifblank{#1}{\dotarg}{#1}
  \ifblank{#2}{\,\delimsize\vert\,\mathopen{}}
  {\,\delimsize\lvert\,\mathopen{}#2\,\delimsize\rvert\,\mathopen{}}
  \ifblank{#3}{\dotarg}{#3} }
\NewDocumentCommand\oldBraket{sO{}mO{}mO{}O{}O{}O{}}
{\PackageWarning{mathMacr}{oldBraket is depreciated.  Use braket}
  \IfBooleanTF #1
  {\prescript{#8}{#9}{\braketDPD*{#3}{#4}{#5}{#6}{#7}}}
  {\prescript{#8}{#9}{\braketDPD[#2]{#3}{#4}{#5}{#6}{#7}}}
}
\NewDocumentCommand\helperBraket{sO{}O{}O{}O{}O{}mmm}
{\IfNoValueT{#8}{\PackageWarning{mathMacr}{Bad usage of braket}}
  \IfBooleanTF #1
  {
    \IfNoValueTF{#9}
    {
      \prescript{#5}{#6}{\braketDPD*{#7}{}{#8}{#3}{#4}}
    }
    {
      \prescript{#5}{#6}{\braketDPD*{#7}{#8}{#9}{#3}{#4}}
    }
  }
  {
    \IfNoValueTF{#9}
    {
      \prescript{#5}{#6}{\braketDPD[#2]{#7}{}{#8}{#3}{#4}}
    }
    {
      \prescript{#5}{#6}{\braketDPD[#2]{#7}{#8}{#9}{#3}{#4}}
    }
  }
}
\NewDocumentCommand\braket{sO{}>{\SplitArgument{2}{|}}mO{}O{}O{}O{}}
{\IfBooleanTF #1
  {\helperBraket*[][#4][#5][#6][#7]#3}
  {\helperBraket[#2][#4][#5][#6][#7]#3}
}
% ----------

\DeclareDocumentCommand\od{O {} m m}{
  \frac{\dif\ifblank{#1}{}{^{#1}} #2}{\dif #3\ifblank{#1}{}{^{#1}}}
}
\DeclareDocumentCommand\evalOd{O {} m m m}{
  \eval*{
    \frac{\dif\ifblank{#1}{}{^{#1}} #2}{\dif #3\ifblank{#1}{}{^{#1}}}
  }{#4}
}
\DeclareDocumentCommand\pd{O {} m m}{
  \frac{\del\ifblank{#1}{}{^{#1}} #2}{\del #3\ifblank{#1}{}{^{#1}}}
}
\DeclareDocumentCommand\evalPd{O {} m m m}{
  \eval*{
    \frac{\del\ifblank{#1}{}{^{#1}} #2}{\del #3\ifblank{#1}{}{^{#1}}}
  }{#4}
}
\DeclareDocumentCommand\ppd{O {} m m m}{
  \frac{\del\ifblank{#1}{^{2}}{^{#1}} #2}{\del #3 \del #4 }
}
\DeclareDocumentCommand\evalPpd{O {} m m m m}{
  \eval*{
    \frac{\del\ifblank{#1}{^{2}}{^{#1}} #2}{\del #3 \del #4 }
  }{#5}
}
\NewDocumentCommand\hoelder{mm}  % HÃ¶lder spaces
{C^{#1}\ifblank{#2}{}{(#2)}}
\NewDocumentCommand\hoelderN{sO{}mO{}mO{}}
{\IfBooleanTF #1
  {\norm*{#5}[#6][\hoelder{#3}{#4}]}
  {\norm[#2]{#5}[#6][\hoelder{#3}{#4}]}
}
\NewDocumentCommand\sobolevSymb{mm}{
  \IfValueTF{#2}{W^{#1,#2}}{H^{#1}}
}
\NewDocumentCommand\sobolev{sO{} >{\SplitArgument{1}{,}}m m}
{\ifblank{#4}{\sobolevSymb #3}{
    \IfBooleanTF #1
    {\formArg*{\sobolevSymb #3}{#4}}
    {\formArg[#2]{\sobolevSymb #3}{#4}}
  }
}
\NewDocumentCommand\sobolevSimple{>{\SplitArgument{1}{,}}mm}
{\sobolevSymb #1 \ifblank{#2}{}{(#2)}
}
\NewDocumentCommand\sobolevN{sO{}mO{}mO{}}
{\IfBooleanTF #1
  {\norm*{#5}[#6][\sobolevSimple{#3}{#4}]}
  {\norm[#2]{#5}[#6][\sobolevSimple{#3}{#4}]}
}
\NewDocumentCommand\sobolevSN{sO{}mO{}mO{}}
{\IfBooleanTF #1
  {\abs*{#5}[#6][\sobolevSimple{#3}{#4}]}
  {\abs[#2]{#5}[#6][\sobolevSimple{#3}{#4}]}
}
\NewDocumentCommand\lebesgue{sO{}mm}
{L^{#3}
  \ifblank{#4}{}{
    \IfBooleanTF #1 {\deli*{#4}}{\deli[#2]{#4}}
  }
}
\NewDocumentCommand\lebesgueSimple{mm}
{L^{#1}\ifblank{#2}{}{(#2)}}
\NewDocumentCommand\lebesgueN{sO{}mO{}mO{}}
{\IfBooleanTF #1
  {\norm*{#5}[#6][\lebesgueSimple{#3}{#4}]}
  {\norm[#2]{#5}[#6][\lebesgueSimple{#3}{#4}]}
}
% \DeclareDocumentCommand{\Lnorm}{ O{} O{2} m}{ 
%   \lVert #3\rVert_{ 
%     L^{#2}\ifthenelse{\isempty{#1}}{}{(#1)}
%   }
% }
% \DeclareDocumentCommand{\Wnorm}{ O{} O{k,p} m}{
%   \lVert #3\rVert_{
%     W^{#2}\ifthenelse{\isempty{#1}}{}{(#1)}
%   }
% }
% \DeclareDocumentCommand{\Hnorm}{ O{} O{k} m }{
%   \lVert #3\rVert_{
%     H^{#2}\ifthenelse{\isempty{#1}}{}{(#1)}
%   }
% }
\DeclarePairedDelimiterXPP\dualPairDPD[4]{}\langle\rangle
{\ifblank{#3}{}{_{#3}}\ifblank{#4}{}{^{#4}}}
{\ifBlankDot{#1},\ifBlankDot{#2}}
\NewDocumentCommand\dualPair{sO{}mmO{}}
{\IfBooleanTF #1
  {\dualPairDPD*{#3}{#4}{#5}{}}
  {\dualPairDPD[#2]{#3}{#4}{#5}{}}
}


% ----------------------------------------------------------------------

% ----------------------------------------------------------------------
% Costume \eval command.  Found this on TeX exchange 
\ExplSyntaxOn
\DeclareDocumentCommand{\xDeclarePairedDelimiter}{mmmO{}}
 {
  \NewDocumentCommand{#1}{sO{}m}
   {
    \IfBooleanTF{##1}
     {
      \egreg_paired_delimiter_expand:nnnn {#2}{#3}{##3}{#4}
     }
     {
      \egreg_paired_delimiter_fixed:nnnnn {##2}{#2}{#3}{##3}{#4}
     }
   }
 }
\cs_new_protected:Npn \egreg_paired_delimiter_expand:nnnn #1 #2 #3 #4
 {% Fix the spacing issue with \left and \right (D. Arsenau, P. Stephani and
  % H. Oberdiek)
  \mathopen{}
  \mathclose\c_group_begin_token
   \left#1
   \str_if_eq:nnT { . } { #1 } { \kern-\nulldelimiterspace }
   #3
   \group_insert_after:N \c_group_end_token
   \right#2
   \tl_if_empty:nF {#4} { \c_math_subscript_token {#4} }
 }
\cs_new_protected:Npn \egreg_paired_delimiter_fixed:nnnnn #1 #2 #3 #4 #5
 {
  \str_if_eq:nnF {.} { #2 } { \mathopen{#1#2} }
  #4
  \mathclose{#1#3}
  \tl_if_empty:nF {#5} { \c_math_subscript_token {#5} }
 }
\ExplSyntaxOff

% the final optional argument to \xDeclarePairedDelimiter
% is a subscript to the right fence
\xDeclarePairedDelimiter{\xeval}{.}{\rvert}[\evaluateat]
\newcommand{\evaluateat}{}
\NewDocumentCommand{\eval}{somm}{%
  \begingroup
  \renewcommand{\evaluateat}{#4}%
  \IfBooleanTF{#1}
    {\xeval*{#3}}
    {\IfNoValueTF{#2}{\xeval{#3}}{\xeval[#2]{#3}}}%
  \endgroup
}
% ----------------------------------------------------------------------
